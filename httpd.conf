#
# This is the main Apache HTTP server configuration file.  It contains the
# configuration directives that give the server its instructions.
# See <URL:http://httpd.apache.org/docs/2.4/> for detailed information.
# In particular, see 
# <URL:http://httpd.apache.org/docs/2.4/mod/directives.html>
# for a discussion of each configuration directive.
#
# Do NOT simply read the instructions in here without understanding
# what they do.  They're here only as hints or reminders.  If you are unsure
# consult the online docs. You have been warned.  
#
# Configuration and logfile names: If the filenames you specify for many
# of the server's control files begin with "/" (or "drive:/" for Win32), the
# server will use that explicit path.  If the filenames do *not* begin
# with "/", the value of ServerRoot is prepended -- so 'log/access_log'
# with ServerRoot set to '/www' will be interpreted by the
# server as '/www/log/access_log', where as '/log/access_log' will be
# interpreted as '/log/access_log'.

#
# ServerRoot: The top of the directory tree under which the server's
# configuration, error, and log files are kept.
#
# Do not add a slash at the end of the directory path.  If you point
# ServerRoot at a non-local disk, be sure to specify a local disk on the
# Mutex directive, if file-based mutexes are used.  If you wish to share the
# same ServerRoot for multiple httpd daemons, you will need to change at
# least PidFile.
#
ServerRoot "/etc/httpd"

#
# Listen: Allows you to bind Apache to specific IP addresses and/or
# ports, instead of the default. See also the <VirtualHost>
# directive.
#
# Change this to Listen on specific IP addresses as shown below to 
# prevent Apache from glomming onto all bound IP addresses.
#
#Listen 12.34.56.78:80
Listen 80
#Listen 443
#
# Dynamic Shared Object (DSO) Support
#
# To be able to use the functionality of a module which was built as a DSO you
# have to place corresponding `LoadModule' lines at this location so the
# directives contained in it are actually available _before_ they are used.
# Statically compiled modules (those listed by `httpd -l') do not need
# to be loaded here.
#
# Example:
# LoadModule foo_module modules/mod_foo.so
#
#LoadModule auth_basic_module modules/mod_auth_basic.so
Include conf.modules.d/*.conf

# Load mod_jk.so
#LoadModule jk_module modules/mod_jk.so
#Include	conf/extra/mod_jk.conf

#
# If you wish httpd to run as a different user or group, you must run
# httpd as root initially and it will switch.  
#
# User/Group: The name (or #number) of the user/group to run httpd as.
# It is usually good practice to create a dedicated user and group for
# running httpd, as with most system services.
#
User apache
Group apache

# 'Main' server configuration
#
# The directives in this section set up the values used by the 'main'
# server, which responds to any requests that aren't handled by a
# <VirtualHost> definition.  These values also provide defaults for
# any <VirtualHost> containers you may define later in the file.
#
# All of these directives may appear inside <VirtualHost> containers,
# in which case these default settings will be overridden for the
# virtual host being defined.
#

#
# ServerAdmin: Your address, where problems with the server should be
# e-mailed.  This address appears on some server-generated pages, such
# as error documents.  e.g. admin@your-domain.com
#
ServerAdmin root@localhost

#
# ServerName gives the name and port that the server uses to identify itself.
# This can often be determined automatically, but we recommend you specify
# it explicitly to prevent problems during startup.
#
# If your host doesn't have a registered DNS name, enter its IP address here.
#
ServerName ca.gridcenter.or.kr

#
# Deny access to the entirety of your server's filesystem. You must
# explicitly permit access to web content directories in other 
# <Directory> blocks below.
#
<Directory />
    #Options FollowSymLinks
    AllowOverride AuthConfig 
    Order deny,allow
    #Require all denied
    LimitRequestBody 5000000 
    Deny from all
</Directory>

#
# Note that from this point forward you must specifically allow
# particular features to be enabled - so if something's not working as
# you might expect, make sure that you have specifically enabled it
# below.
#

#Loglevel
LogLevel warn

#
# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.
#
#DocumentRoot "/var/www/html"
DocumentRoot "/kistica/html"

#
# Relax access to content within /var/www.
#
<Directory "/kistica">
    AllowOverride AuthConfig
    # Allow open access:
    Require all granted
    LimitRequestBody 5000000
</Directory>

# Further relax access to the default document root:
<Directory "/kistica/html">
    #
    # Possible values for the Options directive are "None", "All",
    # or any combination of:
    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews
    #
    # Note that "MultiViews" must be named *explicitly* --- "Options All"
    # doesn't give it to you.
    #
    # The Options directive is both complicated and important.  Please see
    # http://httpd.apache.org/docs/2.4/mod/core.html#options
    # for more information.
    #
    # Options Indexes FollowSymLinks

    #
    # AllowOverride controls what directives may be placed in .htaccess files.
    # It can be "All", "None", or any combination of the keywords:
    #   Options FileInfo AuthConfig Limit
    #
    AllowOverride AuthConfig 

    #
    # Controls who can get stuff from this server.
    #
    ###Require all granted
    Order allow,deny
    Allow from all
    LimitRequestBody 5000000

    <LimitExcept GET POST HEAD>
        deny from all
    </LimitExcept>
    
</Directory>

#
# DirectoryIndex: sets the file that Apache will serve if a directory
# is requested.
#
<IfModule dir_module>
    DirectoryIndex index.php
</IfModule>

#
# The following lines prevent .htaccess and .htpasswd files from being 
# viewed by Web clients. 
#
<Files ".ht*">
    Order allow,deny
    Deny from all
    Satisfy all
    ###Require all denied
</Files>

#Loadbalancer
LoadModule slotmem_shm_module modules/mod_slotmem_shm.so
LoadModule watchdog_module modules/mod_watchdog.so
LoadModule heartmonitor_module modules/mod_heartmonitor.so
LoadModule lbmethod_heartbeat_module modules/mod_lbmethod_heartbeat.so

<IfModule heartmonitor_module>
    HeartbeatStorage shm
    HeartbeatMaxServers 15
#    HeartbeatMaxCounters 20
#    HeartbeatMaxWorkers 10
</IfModule>

#
# ErrorLog: The location of the error log file.
# If you do not specify an ErrorLog directive within a <VirtualHost>
# container, error messages relating to that virtual host will be
# logged here.  If you *do* define an error logfile for a <VirtualHost>
# container, that host's errors will be logged there and not here.
#
ErrorLog "logs/error_log"
#ErrorDocument 403 "Sorry, we can't handle this"
#ErrorDocument 403 /index.php
#ErrorDocument 404 "Sorry, we can't handle this"
#ErrorDocument 402 "Sorry, we can't handle this"
ErrorDocument 402 /error/error404.php
ErrorDocument 404 /error/error404.php
ErrorDocument 403 /error/error404.php


#
# LogLevel: Control the number of messages logged to the error_log.
# Possible values include: debug, info, notice, warn, error, crit,
# alert, emerg.
#


<IfModule log_config_module>
    #
    # The following directives define some format nicknames for use with
    # a CustomLog directive (see below).
    #
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%h %l %u %t \"%r\" %>s %b" common

    <IfModule logio_module>
      # You need to enable mod_logio.c to use %I and %O
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>

    #
    # The location and format of the access logfile (Common Logfile Format).
    # If you do not define any access logfiles within a <VirtualHost>
    # container, they will be logged here.  Contrariwise, if you *do*
    # define per-<VirtualHost> access logfiles, transactions will be
    # logged therein and *not* in this file.
    #
    #CustomLog "logs/access_log" common

    #
    # If you prefer a logfile with access, agent, and referer information
    # (Combined Logfile Format) you can use the following directive.
    #
    CustomLog "logs/access_log" combined
</IfModule>

<IfModule alias_module>
    #
    # Redirect: Allows you to tell clients about documents that used to 
    # exist in your server's namespace, but do not anymore. The client 
    # will make a new request for the document at its new location.
    # Example:
    # Redirect permanent /foo http://www.example.com/bari

    #
    # Alias: Maps web paths into filesystem paths and is used to
    # access content that does not live under the DocumentRoot.
    # Example:
    Alias /icons /kistica/html/icons

    #
    # If you include a trailing / on /webpath then the server will
    # require it to be present in the URL.  You will also likely
    # need to provide a <Directory> section to allow access to
    # the filesystem path.

    #
    # ScriptAlias: This controls which directories contain server scripts. 
    # ScriptAliases are essentially the same as Aliases, except that
    # documents in the target directory are treated as applications and
    # run by the server when requested rather than as documents sent to the
    # client.  The same rules about trailing "/" apply to ScriptAlias
    # directives as to Alias.
    #
    ScriptAlias /cgi-bin/ "/kistica/cgi-bin/"

</IfModule>


<IfModule mod_headers.c>
  <Directory />
    Header always set X-XSS-Protection "1; mode=block"
    Header always set x-Frame-Options "sameorigin"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    #Header always set Content-Security-Policy "default-src *; font-src * data: ;img-src * data: ; script-src 'nonce-30cd87ad3c75a9b10061be9fe9122839' 'nonce-65a652b07e291cc30911f51262f558e7' 'nonce-25b064964c9de7f191d491777bdc2de3' 'nonce-73fa8804a515fcb382ca6be090d1797e' 'nonce-7abe124e04071eb82e21da41e8407912' 'nonce-239d751b8a653c0cb7fd663da9deb820' 'nonce-6e4927df7f3b9aacf12892455791dec3' 'nonce-6f236925325e7a76eaa77450eea83215' 'nonce-56af4352b8007cf2e66ba29b6afa1ab3' 'nonce-a5b9da55d620cec5716ab170e4d6d036' 'nonce-5dceff31ad28bd473e3cda317332f242'; style-src 'self' 'unsafe-inline' ; frame-src *"
    #Header always set Content-Security-Policy "default-src 'self'; font-src * data: ;img-src * data: ; worker-src 'self' blob:; script-src * 'sha256-3B2uKrpDKrAABSpooFv0tbXDqN/PrCQu5O4uqBi5bt4=' 'sha256-vFtlM4aK9LHdAYu+vZOEF8Uru2e+F4Nvt+/Rky/juGs=' 'sha256-uf634gZUIIuHDK0fkv5Fr2lPzgECNKCdYhjjiKk3EyE=' 'sha256-SQEdMtQ3LvxnfQqaglwaqPByucpJAwtJrVq8NvvCKOs=' 'sha256-uf634gZUIIuHDK0fkv5Fr2lPzgECNKCdYhjjiKk3EyE=' 'sha256-xjp4OhddsHCbK4qmq9AEkQ3GTmA2iK98Gc3Yroopcqg=' 'sha256-D9UIgEHzzbu0Gooy7aUr9VDwR6kXTMHHu/oIhGexjKs=' 'sha256-KeebnWEqVkfUfq7ZHML88PuVxFwbSJaeuwbwNiGC3Ms=' 'sha256-pXBKyzxkasqZAhKhqWAF7O2C4eG4D963RTuKKSsqK9U=' 'sha256-1ZeW2eMAgA7Kph7B2NbtjNwEXSY2D1YGYhipcgBPKHA=' 'sha256-JlGGXPugEcitQe/WpWsHKu+Bvlt3PEwOF+VJxLydTqg=' 'sha256-8KAvzYPSSEwi3okNXDv18p8flOe1PK6tS0SvGkKDXhA=' 'sha256-J8dSleoFpw+oiIiW2HsoEz4MRi24PEIS43Ap6QN4cHw=' 'sha256-emTOVin2sYYgde6j9MdgN1Off+qT0RK7H7mEH6EQi48=' 'sha256-2zqrEJG1t/Hxz/eN+tCIiB4S+azlWr9HLAsTeHOhz6o=' 'sha256-kzHCjj9pKbkp3pb5PHYQ8QueY6ZKp7IXRy2KdSKE5Lk=' 'sha256-VAhY/OyoONSVafgfjEpm7VXqT1fx6kn6+/eSenGLoYE=' 'sha256-LA6YqVQECCTpbVvTpWW3wgRpIA+Hik+ibMlWvlyGMbg=' 'sha256-0BcM6BisyQDZ9C/iz3/P0CtltxnfDDkzmr8cl47hIy4=' 'sha256-4nhI/iYDp0szrp6KvOyp2D8l9HYbP3IuCsCBwXqSiLY=' 'sha256-/b4b+DJj1b6msJf86T+hVI+IpStaagiM7JSUP9M41K0=' 'sha256-R/vom8kadhkSPsnQ67K6UBznqZN0IIgXHMBwyjg1G68=' 'sha256-sdAYZRDzwKlAJaqfkyhhXwjsOnQUurW4RyI2xlwcKlU=' 'sha256-cL7VFMmS+3esJ6OUWOLw9ShOdBJx8R2q8cb5OahPYHo=' 'sha256-6McYJMucuJYnmm/mIHf6YK4Z2YnspxvAiskeAMS07DM=' 'sha256-Y7CBs6Bw5A+DSiw29j5o7dfSOKTk9eyo4Mxa8YBW1+k=' 'sha256-sX0SHwiAobgQ5BDtu5Y6rZiQMvIkQc2idZ2kbfC1xBc=' 'sha256-3y2Xmn8Fb05rz3YXEnI9IMYjBECgAyHTYlOMrstfTBc=' 'sha256-6SsKaA1HYNBrC1UwIhgmW8LWQ+aW6fwoytw/KEZKXng=' 'sha256-CL6qOe6/lBNAF+iw/8csGsLxiX3CBbsyLzK59wVrcP8=' 'sha256-lRrOdP4deU9PNo070phelI100GT/8eX9nq0N6NQVRLc=' 'sha256-gD+dXR6kXnxt2V5stKrMl7MfkNNB1gbeDz9Kefx7zdY=' 'sha256-KGiKIJD3HH8oc8fAU5AIuteAU94e1X/Taj7HmEI3PGg=' 'sha256-4PpqljcfZ3W9d1cwjfnx/tXhcXZ9Hor4CLxqgISFc98=' 'sha256-cuWNJrs8E2QJCbSaLw2g9JXiHOpT8yR4YY8npRMJveA=' 'sha256-FhV/eqBQPFIPya3Y24erwdUq/ecmL7YCqB1X/xJreR4=' 'sha256-ByBo9ZnsjedsaYv1oDDl6ARH+zyKMxQsxWlyPyOEjuI=' 'sha256-vbs/E4e7O55QxdW1DvopXKXvhbGP0hARdmqlUgGWOjY=' 'sha256-I2JY4mF04lOV1nxz30coAU6PGAUKivLF46J70v+1YLA=' 'sha256-EURvpYs38NaEI5oo8ofEDOjjYY9veJej5z3hMItLjtU=' 'sha256-/tNRlpQAssX/fxkMEOElsxmwKkZfiuaMPQPyZBrQfN8=' 'sha256-mL7WO38sQ/iO22vM4/5VwTQ1iMCwqjfKBAPpEwNBD/w=' 'nonce-7abe124e04071eb82e21da41e8407912' 'sha256-pLyz/UYtGysOeFB/GLBeywrlCMUFGDs6oVk5hClv/bM=' 'sha256-iapte+hD135n0UqHn36fUqyTbTSEQZwfYyjc04EQ9IU=' 'sha256-plMSZu7uBspob1MHln+srC09c1Hk65eNu7XiY+vBxQk=' 'sha256-iCL0XcaYh2YNcXj9iHzFTkjhfJSddSCHLJ8rHr6WofA=' 'sha256-RlwmTyVxvj4fQn9S0HS5JNjjLKQ5RNoYMkByDA0arK8=' 'sha256-SNJn1NSAHG2c4UdwITil5L4RtrHEYGDZT+9fayUKVlU=' 'sha256-ewow4zBSLc3wqkdWAqhM8xlgcdCUspnWJzAPT7MmJqk=' 'sha256-93HdwkP1Yny2Q+kTK1N8XueqRs1uS+nSRkfN1lMgb70=' ; style-src 'self' 'unsafe-inline'; frame-src 'self'; object-src 'self'; "
    Header always set Content-Security-Policy "default-src * data: blob: filesystem:; script-src * 'unsafe-inline' 'unsafe-eval' data: blob:; style-src * 'unsafe-inline' data:; img-src * data: blob:; font-src * data:; frame-src *;"
    
    # Expect-CT는 최신 브라우저에서 무시되거나 경고를 냅니다. 주석 처리 권장.
    #Header always set Expect-CT "enforce, max-age=300, report-uri='http://ca.gridcenter.or.kr'"
    
    # Feature-Policy는 Permissions-Policy로 대체되었습니다. (유지해도 무방하나 최신 표준은 아님)
    Header always set Feature-Policy "microphone 'none'; payment 'none'; sync-xhr 'self' http://ca.gridcenter.or.kr https://pki.gridcenter.or.kr"
    #Header always set Referrer-Policy "strict-origin"
    
    # 4. CORS 및 리퍼러 정책
    Header always set Access-Control-Allow-Origin "*"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
  </Directory>
</IfModule>


#
# "/var/www/cgi-bin" should be changed to whatever your ScriptAliased
# CGI directory exists, if you have that configured.
#
<Directory "/kistica/cgi-bin">
    AllowOverride AuthConfig 
    Options None
    Order allow,deny
    ###Require all granted
</Directory>

<IfModule mime_module>
    #
    # TypesConfig points to the file containing the list of mappings from
    # filename extension to MIME-type.
    #
    TypesConfig /etc/mime.types

    #
    # AddType allows you to add to or override the MIME configuration
    # file specified in TypesConfig for specific file types.
    #
    #AddType application/x-gzip .tgz
    #
    # AddEncoding allows you to have certain browsers uncompress
    # information on the fly. Note: Not all browsers support this.
    #
    #AddEncoding x-compress .Z
    #AddEncoding x-gzip .gz .tgz
    #
    # If the AddEncoding directives above are commented-out, then you
    # probably should define those extensions to indicate media types:
    #
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType application/x-httpd-php .php .html .htm .inc
    AddType application/x-httpd-php-source .phps

    #
    # AddHandler allows you to map certain file extensions to "handlers":
    # actions unrelated to filetype. These can be either built into the server
    # or added with the Action directive (see below)
    #
    # To use CGI scripts outside of ScriptAliased directories:
    # (You will also need to add "ExecCGI" to the "Options" directive.)
    #
    #AddHandler cgi-script .cgi

    # For type maps (negotiated resources):
    #AddHandler type-map var

    #
    # Filters allow you to process content before it is sent to the client.
    #
    # To parse .shtml files for server-side includes (SSI):
    # (You will also need to add "Includes" to the "Options" directive.)
    #
    AddType text/html .shtml
    AddOutputFilter INCLUDES .shtml
</IfModule>

#
# Specify a default charset for all content served; this enables
# interpretation of all content as UTF-8 by default.  To use the 
# default browser choice (ISO-8859-1), or to allow the META tags
# in HTML content to override this choice, comment out this
# directive:
#
AddDefaultCharset UTF-8

<IfModule mime_magic_module>
    #
    # The mod_mime_magic module allows the server to use various hints from the
    # contents of the file itself to determine its type.  The MIMEMagicFile
    # directive tells the module where the hint definitions are located.
    #
    MIMEMagicFile conf/magic
</IfModule>

<IfModule mpm_prefork_module>
    StartServers          	10
    MinSpareServers      	10
    MaxSpareServers     	30
    MaxRequestWorkers   	256
    MaxConnectionsPerChild   	0
</IfModule>

#<IfModule reqtimeout_module>
#    RequestReadTimeout header=20-40,MinRate=500 body=20,MinRate=500
#</IfModule>

#KeepAlive 
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5

Timeout	600

#<Location /ejbca/>
#	ProxyPass ajp://150.183.244.13:8009/ejbca
#</Location>

#
# Customizable error responses come in three flavors:
# 1) plain text 2) local redirects 3) external redirects
#
# Some examples:
#ErrorDocument 500 "The server made a boo boo."
#ErrorDocument 404 /missing.html
#ErrorDocument 404 "/cgi-bin/missing_handler.pl"
#ErrorDocument 402 http://www.example.com/subscription_info.html
#

#
# EnableMMAP and EnableSendfile: On systems that support it, 
# memory-mapping or the sendfile syscall may be used to deliver
# files.  This usually improves server performance, but must
# be turned off when serving from networked-mounted 
# filesystems or if support for these functions is otherwise
# broken on your system.
# Defaults if commented: EnableMMAP On, EnableSendfile Off
#
#EnableMMAP off
EnableSendfile on

# Supplemental configuration
#
# Load config files in the "/etc/httpd/conf.d" directory, if any.
IncludeOptional conf.d/*.conf
#Include /etc/httpd/conf.d/ssl.conf
Include /etc/httpd/conf/extra/httpd-vhost.conf

#mod_jk configuration
#Include /etc/httpd/conf/extra/mod_jk.conf


#ServerTokens OS
ServerTokens Prod
ServerSignature Off

#Disable Trace HTTP Request
TraceEnable off





