
<VirtualHost *:80>
        DocumentRoot "/var/www/html/pub"
        ServerName ca.gridcenter.or.kr/kisticav3
	Alias /kisticav3	"/var/www/html/pub/"
        ErrorLog logs/error_log_public
#       CustomLog logs/custom_log_127.220.80
</VirtualHost>

<VirtualHost *:4443>
        DocumentRoot "/var/www/html/pki"
        ServerName      pki.gridcenter.or.kr:4443
        ServerAdmin     kisti-grid-ca@kisti.re.kr 

	ErrorLog logs/ssl_error_log
	TransferLog logs/ssl_access_log
	LogLevel warn

	SSLEngine on

	SSLProtocol all -SSLv2 -SSLv3

	SSLCipherSuite HIGH:3DES:!aNULL:!MD5:!SEED:!IDEA

	SSLCertificateFile /etc/pki/tls/certs/server.crt

	SSLCertificateKeyFile /etc/pki/tls/private/server.key

	SSLCACertificateFile /etc/pki/tls/certs/ca.crt

	SSLVerifyClient require

	SSLVerifyDepth  1

	<Files ~ "\.(cgi|shtml|phtml|php3?)$">
	    SSLOptions +StdEnvVars
	</Files>
	<Directory "/var/www/cgi-bin">
	    SSLOptions +StdEnvVars
	    LimitRequestBody 5000000
	</Directory>
	
	ErrorDocument 402 /error/error404.php
	ErrorDocument 404 /error/error404.php
	ErrorDocument 403 /error/error404.php

	<IfModule mod_headers.c>
	    Header always set X-XSS-Protection "1; mode=block"
	    Header always set x-Frame-Options "DENY"
	    Header always set X-Content-Type-Options "nosniff"
	    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
	    #Header always set Content-Security-Policy "default-src 'self'; font-src 'self': ;img-src 'self': ; script-src 'self' ; style-src 'self'"
	    Header always set Content-Security-Policy "default-src 'self'; font-src 'self': ;img-src 'self': ; script-src '*' ; style-src 'self'"
	    Header always set Expect-CT "enforce, max-age=300, report-uri='https://pki.gridcenter.or.kr:4443'"
	    Header always set Feature-Policy "microphone 'none'; payment 'none'; sync-xhr 'self' https://pki.gridcenter.or.kr:4443"
	    Header always set Referrer-Policy "strict-origin"
	    Header always set Access-Control-Allow-Origin "*"
	</IfModule>

	BrowserMatch "MSIE [2-5]" \
         nokeepalive ssl-unclean-shutdown \
         downgrade-1.0 force-response-1.0

	CustomLog logs/ssl_request_log \
          "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"

</VirtualHost>

